<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DrivePK AI - Voice</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
:root {
  --red:#E81F25;
  --black:#000;
}
body {
  background:#111;
  margin:0;
  font-family:'Segoe UI', sans-serif;
  display:flex;
  justify-content:center;
  height:100vh;
}
.app-container {
  width:100%;
  max-width:420px;
  background:#fff;
  display:flex;
  flex-direction:column;
}
header {
  background:var(--black);
  color:#fff;
  padding:16px;
  text-align:center;
  font-weight:bold;
  border-bottom:4px solid var(--red);
}
.hero {
  height:35vh;
  background:url('https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?q=80&w=800') center/cover;
}
#chat {
  flex-grow:1;
  padding:16px;
  overflow-y:auto;
}
.bubble {
  background:#f2f2f2;
  padding:12px 14px;
  border-radius:14px;
  margin-bottom:10px;
  font-size:15px;
  border-left:4px solid var(--red);
}
footer {
  padding:16px;
  display:flex;
  gap:10px;
}
.btn-main {
  flex:1;
  background:var(--red);
  color:#fff;
  border:none;
  padding:14px;
  border-radius:12px;
  font-size:16px;
  font-weight:bold;
}
.btn-stop {
  flex:1;
  background:#444;
  color:#fff;
  border:none;
  padding:14px;
  border-radius:12px;
  font-size:16px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="app-container">
  <header>DRIVEPK EXPERT</header>
  <div class="hero"></div>

  <div id="chat">
    <div class="bubble">
      Click START CALL to begin.
    </div>
  </div>

  <footer>
    <button class="btn-main" id="callBtn">ðŸ“ž START CALL</button>
    <button class="btn-stop" id="stopBtn">â›” STOP</button>
  </footer>
</div>

<script>
const VOICE_ENDPOINT = "https://meilibeauty.co.uk/voice.php";

let ringTone = new Audio("https://actions.google.com/sounds/v1/alarms/telephone_ring.ogg");
let currentVoice = null;
let ringTimeout1 = null;
let ringTimeout2 = null;
let speakTimeout = null;

// Speak via backend
async function speak(text) {
  const res = await fetch(VOICE_ENDPOINT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text })
  });

  const blob = await res.blob();
  currentVoice = new Audio(URL.createObjectURL(blob));
  currentVoice.play();
}

// Start call
function startCall() {
  stopAll(); // reset first

  ringTone.currentTime = 0;
  ringTone.play();

  ringTimeout1 = setTimeout(() => {
    ringTone.pause();
    ringTone.currentTime = 0;
    ringTone.play();
  }, 2000);

  speakTimeout = setTimeout(() => {
    ringTone.pause();
    ringTone.currentTime = 0;

    const msg =
      "Assalam-o-Alaikum, mera naam Reshma hai. Main aap ki kis tarah madad kar sakti hoon?";

    document.getElementById("chat").innerHTML +=
      `<div class="bubble"><b>Reshma:</b><br>${msg}</div>`;

    speak(msg);
  }, 4000);
}

// Stop everything immediately
function stopAll() {
  if (ringTone) {
    ringTone.pause();
    ringTone.currentTime = 0;
  }
  if (currentVoice) {
    currentVoice.pause();
    currentVoice.currentTime = 0;
  }
  clearTimeout(ringTimeout1);
  clearTimeout(ringTimeout2);
  clearTimeout(speakTimeout);
}

document.getElementById("callBtn").onclick = startCall;
document.getElementById("stopBtn").onclick = stopAll;
</script>

</body>
</html>
