<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DrivePK BOLO</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#eee}
header{background:#000;color:#fff;padding:12px;display:flex;gap:10px;align-items:center}
.logo{background:#e81f25;width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:bold}
.main{padding:12px}
.hero{background:#000;color:#fff;border-radius:18px;height:22vh;min-height:160px;display:flex;flex-direction:column;justify-content:center;align-items:center}
.hero h1{margin:0;font-size:34px}
.hero h2{margin:6px 0 0;color:#e81f25;font-size:15px}

input,button{width:100%;height:52px;border-radius:14px;font-size:16px}
input{padding:0 14px;border:1px solid #ccc;margin-top:8px}
button{border:none;background:#000;color:#fff;margin-top:8px}
.call{background:#e81f25}
.call.talking{background:#0a7a0a}
#status{margin-top:8px;color:#e81f25;font-weight:bold}
.car{background:#fff;border-radius:14px;padding:10px;margin-top:10px}
</style>
</head>

<body>

<header>
  <div class="logo">D</div>
  <div><strong>DrivePK</strong><br><small>Bolo aur gaari dhoondo</small></div>
</header>

<div class="main">
  <div class="hero">
    <h1>DrivePK</h1>
    <h2>Roman Urdu Voice Search</h2>
  </div>

  <input id="query" placeholder="Jaise: Honda 2019 Lahore">
  <button id="searchBtn">Search</button>
  <button id="callBtn" class="call">ðŸŽ¤ TALK</button>

  <div id="status"></div>
  <div id="results"></div>
</div>

<script>
/* =======================
   VOICE CONFIG
======================= */

const LADIES = {
  Kiran:{voice:"marin",speed:0.95},
  Reshma:{voice:"cedar",speed:0.95},
  Shaheen:{voice:"sage",speed:0.95}
};

const RESULT_LINES=[
 "Yeh rahi aap ki search results.",
 "Aap ke liye kuch gaariyan mil gayi hain.",
 "Search complete ho gayi hai."
];

const NO_RESULT_LINES=[
 "Maaf kijiye, is search par koi gaari available nahi.",
 "Abhi is requirement ki koi gaari nahi mili."
];

const profile = JSON.parse(localStorage.getItem("drivepk_profile")||"{}");
function saveProfile(){localStorage.setItem("drivepk_profile",JSON.stringify(profile));}

function respectfulName(){
 if(!profile.name) return "";
 if(profile.name.toLowerCase().includes("dr")) return "Dr sahib";
 return profile.name+" bhai";
}

if(!profile.lady){
 const keys=Object.keys(LADIES);
 profile.lady=keys[Math.floor(Math.random()*keys.length)];
 saveProfile();
}

/* =======================
   SPEAK
======================= */
async function speak(text,voicePack){
 const vp=voicePack||LADIES[profile.lady];
 const res=await fetch("https://meilibeauty.co.uk/voice.php",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({text,voice:vp.voice,speed:vp.speed})
 });
 const audio=new Audio(URL.createObjectURL(await res.blob()));
 return audio.play();
}

/* =======================
   NAME SAFETY
======================= */

const NAME_BLACKLIST=[
 "honda","toyota","suzuki","kia","mg","byd","lahore","karachi","car","gaari","model","year"
];

function normalize(t){return t.toLowerCase();}

function isExplicitName(t){
 t=normalize(t);
 return t.startsWith("my name is")||t.startsWith("mera naam")||t.startsWith("i am");
}

function extractName(t){
 t=normalize(t)
  .replace("my name is","")
  .replace("mera naam","")
  .replace("i am","")
  .trim();
 for(const b of NAME_BLACKLIST){if(t.includes(b))return null;}
 if(!/^[a-z\s]{2,25}$/.test(t))return null;
 return t.split(" ").map(w=>w[0].toUpperCase()+w.slice(1)).join(" ");
}

/* =======================
   MIC
======================= */
let rec=null;
if("webkitSpeechRecognition"in window){
 rec=new webkitSpeechRecognition();
 rec.lang="en-GB";
 rec.onresult=e=>handleText(e.results[0][0].transcript);
}

/* =======================
   CORE HANDLER
======================= */
async function handleText(text){
 status.innerText="Aap ne kaha: "+text;

 // name
 if(!profile.name && isExplicitName(text)){
  const n=extractName(text);
  if(n){profile.name=n;saveProfile();await speak("Shukriya "+respectfulName()+". Ab apni requirement bol dein.");return;}
 }

 // boss
 if(text.toLowerCase().includes("boss")||text.toLowerCase().includes("complain")){
  document.getElementById("results").innerHTML="<div class='car'>ðŸ“ž Complaint: 0300-8319037</div>";
  await speak("Theek hai. Complaint ka number screen par show ho raha hai.");
  await speak("Assalam o Alaikum. Main Umar hoon. Aap ka masla kya hai?",{voice:"onyx",speed:0.95});
  return;
 }

 // search
 runSearch(text);
}

/* =======================
   SEARCH
======================= */
async function runSearch(text){
 results.innerHTML="Searchingâ€¦";
 const res=await fetch("https://meilibeauty.co.uk/search.php",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({text})
 });
 const json=await res.json();
 if(!json.data||!json.data.length){
  results.innerHTML="<div class='car'>No cars found</div>";
  await speak(NO_RESULT_LINES[Math.floor(Math.random()*NO_RESULT_LINES.length)]);
  return;
 }
 results.innerHTML="";
 json.data.forEach(c=>{
  results.innerHTML+=`<div class='car'><strong>${c.title}</strong><br>PKR ${c.price}</div>`;
 });
 await speak(RESULT_LINES[Math.floor(Math.random()*RESULT_LINES.length)]);
}

/* =======================
   BUTTONS
======================= */
callBtn.onpointerdown=()=>{
 callBtn.classList.add("talking");
 status.innerText="Sun rahi hoonâ€¦";
 try{rec.start();}catch{}
};
callBtn.onpointerup=()=>{
 callBtn.classList.remove("talking");
 try{rec.stop();}catch{}
};

searchBtn.onclick=()=>query.value&&handleText(query.value);
</script>

</body>
</html>