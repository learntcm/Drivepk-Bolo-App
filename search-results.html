<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>DrivePK – Search Results</title>

<style>
  :root{
    --red:#ef1d1d;
    --bg:#0f0f0f;
    --card:#1a1a1a;
    --muted:#a9a9a9;
    --line:#2a2a2a;
  }
  body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:#fff;}
  .topbar{
    position:sticky;top:0;z-index:10;
    background:rgba(15,15,15,.95);backdrop-filter: blur(8px);
    border-bottom:1px solid var(--line);
    padding:12px 14px;
  }
  .topbar .row{display:flex;gap:10px;align-items:center;}
  .qbox{
    flex:1;display:flex;gap:8px;align-items:center;
    background:#111;border:1px solid var(--line);border-radius:10px;padding:10px 12px;
  }
  .qbox input{
    width:100%;border:none;outline:none;background:transparent;color:#fff;font-size:14px;
  }
  .btn{
    border:none;border-radius:10px;padding:10px 12px;cursor:pointer;
    background:var(--red);color:#fff;font-weight:700;
  }
  .btn.secondary{background:#2b2b2b;font-weight:600;}
  .container{padding:14px;max-width:720px;margin:0 auto;}
  .meta{color:var(--muted);font-size:13px;margin:10px 2px 14px;}
  .grid{display:flex;flex-direction:column;gap:14px;}
  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:14px;overflow:hidden;
    box-shadow:0 6px 18px rgba(0,0,0,.35);
  }
  .thumb{
    width:100%;height:220px;object-fit:cover;display:block;background:#222;
  }
  .content{padding:12px;}
  .title{font-size:16px;font-weight:800;margin:0 0 6px;}
  .loc{font-size:13px;color:var(--muted);margin:0 0 10px;}
  .specs{
    display:flex;flex-wrap:wrap;gap:8px;
    font-size:12px;color:#e7e7e7;margin:0 0 10px;
  }
  .pill{
    border:1px solid #333;border-radius:999px;padding:6px 10px;background:#151515;
  }
  .price{
    font-size:18px;font-weight:900;color:var(--red);
    margin:0 0 12px;
  }
  .actions{display:flex;gap:10px;}
  .actions button{
    flex:1;border:none;border-radius:10px;padding:10px 12px;cursor:pointer;font-size:14px;
  }
  .view{background:#2b2b2b;color:#fff;font-weight:700;}
  .contact{background:var(--red);color:#fff;font-weight:900;}
  .loader, .end, .error{
    text-align:center;color:var(--muted);padding:18px 8px;font-size:13px;
  }
  .small{font-size:12px;color:var(--muted);}
</style>
</head>

<body>

<div class="topbar">
  <div class="row">
    <div class="qbox">
      <input id="q" type="text" placeholder="Search: Toyota Corolla 2020 Lahore 10 to 30 lakh automatic..." />
    </div>
    <button class="btn" id="searchBtn">Search</button>
    <button class="btn secondary" id="clearBtn">Clear</button>
  </div>
  <div class="small" id="appliedFilters"></div>
</div>

<div class="container">
  <div class="meta" id="meta">Loading…</div>
  <div class="grid" id="list"></div>
  <div class="loader" id="loader" style="display:none;">Loading more cars…</div>
  <div class="end" id="end" style="display:none;">You’ve reached the end.</div>
  <div class="error" id="error" style="display:none;">Could not load results. Please try again.</div>
</div>

<script>
/**
 * DrivePK BOLO Search Results (Android-style)
 * API: GET https://api.drivepk.com/cars
 * Response: { message, data: [...], pagination: {...} }
 */

const API_BASE = "https://api.drivepk.com";
const DEFAULT_LIMIT = 20;

const els = {
  q: document.getElementById("q"),
  searchBtn: document.getElementById("searchBtn"),
  clearBtn: document.getElementById("clearBtn"),
  list: document.getElementById("list"),
  meta: document.getElementById("meta"),
  loader: document.getElementById("loader"),
  end: document.getElementById("end"),
  error: document.getElementById("error"),
  appliedFilters: document.getElementById("appliedFilters"),
};

let state = {
  page: 1,
  limit: DEFAULT_LIMIT,
  hasNext: false,
  total: 0,
  loading: false,
  params: {}
};

/* -----------------------------
   Smart Search Dictionaries
------------------------------ */
const BRAND_LIST = [
  "Toyota","Honda","Suzuki","Kia","Hyundai","Changan","MG","Haval","Nissan",
  "Mitsubishi","Daihatsu","Mercedes","BMW","Audi","Ford","Isuzu","Peugeot","Proton"
];

const CITY_LIST = [
  "Karachi","Lahore","Islamabad","Rawalpindi","Peshawar","Quetta","Multan","Faisalabad",
  "Gujranwala","Sialkot","Hyderabad","Sukkur","Bahawalpur","Sargodha","Gujrat","Abbottabad",
  "Mardan","Swat","Rahim Yar Khan","Sheikhupura","Okara","Kasur","Jhelum"
];

const FUEL_LIST = ["Petrol","Diesel","CNG","Hybrid","Electric"];
const TRANSMISSION_LIST = ["Automatic","Manual","CVT","DCT"];

/* -----------------------------
   Helpers
------------------------------ */
function normalizeSpaces(s){ return String(s || "").replace(/\s+/g," ").trim(); }

function safeText(v, fallback="-") {
  return (v === null || v === undefined || v === "") ? fallback : String(v);
}

function findFirstFromList(text, list) {
  const t = " " + text.toLowerCase() + " ";
  for (const item of list) {
    const needle = " " + item.toLowerCase() + " ";
    if (t.includes(needle)) return item;
  }
  return null